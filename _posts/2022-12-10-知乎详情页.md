---
layout:     post
title:      知乎详情页
subtitle:   知乎回答、文章、想法详情页
date:       2022-12-10
author:     潘世民
header-img: img/2022-12-10/2022-12-10-知乎详情页.jpeg
catalog: true
tags:
    - 知乎
    - 详情页
    - 回答
    - 文章
    - 想法
    - webView
    - ScrollView
---


### 背景
随着知乎的回答越来越水化，站内创作者写的回答的长度越来越短(*目前统计，差不多 70%+ 的回答长度不到 100 字 😂*)；目前线上的回答详情页不管内容长短，详情页都撑满一屏，不足一屏的内容前端同学在内容后面添加留白也要让页面撑满屏幕，下面是一个内容比较短的回答：

![图片](https://gd-hbimg.huaban.com/038ea98a9cb7cd853757b7b81dd1fb52e7e7eb5744ff9-aomJvK_fw1200webp)

从上面 case 可以看出，在内容比较短的情况下，在页面中插入大量的空白；这样白白浪费了很多的空间；
为了提高消费效率和消费深度，我们需要一种新的方案去承接详情页；其实很自然的可以想到，既然回答内容比较短，其实就可以直接使用卡片来展示详情页的内容，而不是继续使用一整个页面展示一个回答；结合知乎详情页的现状(*在推荐页流通的都是优质内容，内容长度大于 300 字*)，我们自然而然的会想到把详情页拆分成2部分：
1、上部分通常用`WebView`实现。常规包括标题 + 作者（关注）+ 资讯内容 + 相关推荐(可选) + 广告(可选) + 热评(可选)，这一部分就是知乎线上的独立的回答详情页、文章详情页、想法详情页；
2、下半部分平行于上半部分的详情页视图，使用一个列表页面展示同问题下的回答、推荐的回答、推荐的文章和想法

详情页还需要处理下面这些问题：
1、需要合理的处理上半部分视图与下半部分视图协同滚动；
2、方便回答详情页、文章详情页、想法详情页等业务接入；
3、支持下拉刷新、上拉加载；
4、点击`next` 按钮切换到列表页面；

![线上详情页](/img/2022-12-10/omni_view.gif)

### 技术方案调研
目前主流的新闻类 `App` 如`今日头条`、`腾讯新闻`、`一点资讯`等内容页详情页其实就是就是我们想要的详情页；既然如此，那么我们就可以逐个分析它们的详情页是如何实现的；

##### 方案一:
在 `WebView` 的底部留一个留一个空白的`div`槽位，用于确定`collectionView`的位置。把`collectionView`加到`webView.scrollView`上，在监听到`webView.scrollView`的`contentSize`变化后，不断调整`collectionView`的位置对应于该空白`div`的位置，同时将该`div`的尺寸设置为`collectionView`的`contentSize`。同时还需要通过`UIPanGestureRecognizer`和`UIDynamicAnimator`模拟滚动产生偏移量来驱动`collectionView`滑动;
![webview_insert_div](/img/2022-12-10/webview_div.png)
这个方案是我前东家`一点资讯`的新闻详情页的实现方案；
这个方案的优点是实现相对比较简单；
缺点：
1、灵活性比较差，对详情页侵入性比较强，同时还需要前端配合；
2、`WebView` 和 `collectionView` 耦合在一起，视图在渲染和展示的时候相互影响；
3、实现复杂的交互很困难，如吸顶、点击`next`切换到列表页面、下拉刷新等等；

#### 方案二：
由于没有在今日头条和腾讯新闻呆过，对于它们的详情页的实现方案我们可以通过 [Lookin](https://lookin.work/) 和 一台越狱设备来分析分析它们的实现方案；
关于如何使用 [Lookin](https://lookin.work/) 分析别人家的`App`，可以参考我以前写的这篇文章 [如何使用 Lookin 分析别人的 APP](https://panshimin.github.io/2020/06/11/Lookin/)







